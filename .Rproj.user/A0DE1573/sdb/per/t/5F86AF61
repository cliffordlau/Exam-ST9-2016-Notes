{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Module 20: Extreme Value Theory\"\nauthor: \"C. Lau\"\ndate: \"`r format(Sys.time(), '%B %d, %Y')`\"\noutput: \n  html_document:\n    toc: true\n    toc_float:\n      collapsed: false\n      smooth_scroll: false\n    toc_depth: 4\n---\n\n## Module Objective\n\nExplain the importance of the tails of distributions, tail correlations and low freq/ high severity events\n\nDemonstrate how extreme value theory can be used to help model risks that have a low probability\n\n***\n\nLook more closely at the tails of distributions\n\nFocus is on considering the modeling of risks with low freq and high sev\n\nNeed to be able to recommend a specific approach and choice of model for the tails based on a mixture of quantitative analysis and graphical diagnostics\n\nShould be able to describe how the main theoretical results can be used in practice\n\n## Tail Distributions/ Correlations\n\nImportant to model the tail of a distribution accurately due to the potentially devastating impact on companies\n\n### Low Freq/ High Sev Events\n\nLow frequency $\\Rightarrow$ Little data to model their effects accurately\n\nExample:\n\n* 2008 credit crisis generated more extreme movements in equity values and credit spreads than had been seen over the 20 years previously\n* Oct 19 1987 Black Monday S&P fell by 20.5% (Which is a 1-in-2100 event based on the estimated return period)\n* 9/11 and other natural disasters like 2013 Philippines typhoon\n\n***Challenge of modeling the tail***\n\n1. We can model the tail by modeling the full distribution but need make sure the **form of the distribution is correct in the tails**\n\n    * Use data from both stressed and non-stressed periods to fit the distribution\n    * Financial data is typically more leptokurtic (narrow peak and fat tail)\n        * $\\therefore$ Extreme values for equity occur more frequently than predicted with a normal distribution\n        * A better distribution would be *t* distribution\n\n    **Reasons for fat tails** in financial data\n\n    * Heteroscedastic returns (i.e. volatility varies over time)\n    * Innovation in a heteroscedastic model are best modeled using a fat tailed distribution\n\n2. **Fitting the tail**\n\n    * Difficult since paramter estimates are **heavily influenced** by the main bulk of the data in the **middle of the distribution**\n    * This is where extreme value theory comes can help\n    \n## Extreme Value Theory\n\n### Definition of Extreme\n\n2 approach:\n\n1. Consider an extreme value as the maximum value in a set of $n$ losses\n\n    **Block maximum**\n    \n    e.g. $X_M = max(X_1,X_2,...,X_n)$\n\n2. Consider all losses that exceed a certain **threshold** as being extreme\n\n### Limiting Behaviour\n\nFor losses that have typical sizes (values from the central part of the distribution) we can use CLT\n\n* CLT: standardized value of the average loss $\\dfrac{\\bar{X} - \\mu}{\\sigma/\\sqrt{n}}$ can be approximated using a normal distribution\n    * $\\bar{X}$ is the mean of the $n$ samples from a distribution with mean $\\mu$ and variance $\\sigma$\n    \nNeed similar method to estimate the behavior of the extreme values in the tail of the distribution\n\nExtreme value theory has the 2 main results below\n\nKey idea of extreme value theory is that there are certain families of distributions (Generalized Extreme Value and Generalized Pareto) that describe the behavior of the tails of many distributions\n\n#### Maxima\n\nThe distribution of the block maxima $X_M = max(X_1, X_2,...,X_n)$ is approximately described by the **Generalized Extreme Value (GEV) family** of distributions if $n$ is sufficiently large\n\nLook at $X_M = max(X_1, X_2,...,X_n)$, block maxima\n\nIf we look at a number of such blocks then these maxima can be standardized in a similar way\n\n* i.e. We calculate expressions of the form $\\dfrac{X_M - \\alpha_n}{\\beta_n}$\n* Can approximate by an extreme value distribution\n\n#### Threshold Exceedances\n\nThe tail of the distribution above a threshold $\\Pr(X>x+u \\mid X>u)$ can be approximated, for large values of $u$ by the **Generalized Pareto Distribution** (GPD)\n\n* Consider the expected size of losses that exceed a certain thresholds\n\n## Generalized Extreme Value Distribution\n\nGeneralized Extreme Value family of distributions are important in the study of limiting behavior of sample extremes\n\n### Extreme Values Theorem (EVT)\n\nNeed distribution of $X_M = max(X_1, X_2,...,X_n)$ where each $X_i$ is an observed loss\n\nIf losses are *iid* with CDF $F$:\n\n$\\begin{align}\n  P(X_M \\leq x) &= P(X_1 \\leq x, X_2 \\leq x, ..., X_n \\leq x) \\\\\n  &= P(X_1\\leq x)P(X_2\\leq x)...P(X_n \\leq x) \\\\\n  &= \\left[ P(X_1\\leq x) \\right]^n\n  &= \\left[ F(x) \\right]^n\n  &= F^n (x)\\\\\n\\end{align}$\n\nStandardized for a sequence of real constants $\\beta_1,...,\\beta_n > 0$ and $\\alpha_1,...,\\alpha_n$ and consider the limit as $n$ increases:\n\nLimiting distribution $H(x)$\n\n$H(x) = \\lim \\limits_{n \\rightarrow \\infty} P \\left(\\dfrac{X_M - \\alpha_n}{\\beta_n} \\leq x \\right) = \\lim \\limits_{n \\rightarrow \\infty} F^n(\\beta_n x + \\alpha_n)$\n\nResult applies for all commonly used statistical distributions from which the $X_i$ may originate\n\n***Example***\n\nDetermine $H(x)$ where $X_i$ are exponentially distribution (i.e. $F(x) = 1 - e^{-\\lambda x}$) by setting $\\beta = \\dfrac{1}{\\lambda}$ (i.e. $\\beta_n = \\beta$ for all $n$) and $\\alpha_n = \\dfrac{1}{\\lambda} \\ln(n)$\n\nSubstituting the above into $\\beta x + \\alpha_n$:\n\n$\\begin{align}\n  F(\\beta x + \\alpha_n) &= F\\left( \\dfrac{x + \\ln(n)}{\\lambda} \\right) \\\\\n  &= 1 - \\exp\\left\\{-\\lambda\\left(\\dfrac{x + \\ln(n)}{\\lambda}\\right)\\right\\} \\\\\n  &= 1 - \\dfrac{1}{n}e^{-x} \\\\\n\\end{align}$\n\n$\\begin{align}\n  \\lim \\limits_{n \\rightarrow \\infty} F^n(\\beta_n x + \\alpha_n) &= \\lim \\limits_{n \\rightarrow \\infty} \\left( 1 - \\dfrac{1}{n}e^{-x} \\right)^n & \\\\\n  &= e^{-e^{-x}} & \\text{since } e^x = \\lim \\limits_{n \\rightarrow \\infty} \\left( 1 + \\dfrac{x}{n}\\right)^n \\\\\n\\end{align}$\n  \n### GEV Distribution\n\nGEV family of distributions havs 3 parameters\n\n1. $\\alpha$: location parameter\n2. $\\beta > 0$: scale parameter\n\n    $\\alpha$ and $\\beta$ just rescale (shift and stretch) the distribution (similar to mean and s.d.)\n    \n3. $\\gamma$: shape parameter\n\nCDF of the GEV family:\n\n$P(X_M \\leq x) \\approx H(x)\n\\begin{cases}\n  \\exp\\left\\{ -\\left( 1 + \\dfrac{\\gamma(x-\\alpha)}{\\beta} \\right)^{\\frac{-1}{\\gamma}} \\right\\} & \\gamma \\neq 0 \\\\\n  \\exp\\left\\{ - \\exp\\left\\{ - \\dfrac{(x-\\alpha)}{\\beta} \\right\\} \\right\\} & \\gamma = 0\\\\\n\\end{cases}$\n\nCDF of the **standard** GEV distribution has $\\alpha=0$ and $\\beta =1$\n\n#### Three Forms of GEV\n\nThe forms of the GEV family distribution is determined by the sign of $\\gamma$ ((+), (-), 0)\n\n***Gumbel GEV***\n\n$\\gamma=0$\n\nTail falls exponentially\n\n![](figures/figure-18.18.png)\n\n***Weibull GEV***\n\n$\\gamma<0$\n\nFinite upper bound indicating an absolute maximum\n\nApplication:\n\n* Distribution of **natural phenomenon**: e.g. temperature, wind-speed, age of human population etc\n* When loss was certain not to exceed a certain value (e.g. reinsured)\n\n![](figures/figure-18.17.png)\n\n***Fréchet-type GEV***\n\n$\\gamma > 0$\n\nTails of the distribution become heavier\n\n* Follow a power law\n* Infinite variance if $\\gamma > \\dfrac{1}{2}$\n\nApplication:\n\n* Most suitable for modeling extreme financial loss events\n\nDistribution has a lower bound since $x$ takes values such that  $1 + \\dfrac{\\gamma{x-\\alpha}}{\\beta}$ $\\Rightarrow$ $x - \\alpha > \\dfrac{-\\beta}{\\gamma}$ $\\Rightarrow$ $x > \\alpha - \\dfrac{\\beta}{\\gamma}$\n\n![](figures/figure-18.19.png)\n\n### Underlying Distribution\n\nIf we know the form of the underlying loss distribution we can work out the limiting distribution of the maximum value ($H(x)$)(?)\n\nThen we can classify the resulting distribution into one of the 3 types based on the sign of $\\gamma$\n\nGEV Distributions (for the maximum value) corresponding to common loss distributions\n\n\n| Type | Weibull | Gumbel | Fréchet |\n| ------------ | ----------- | -------------- | ---------------- |\n| Shape Parameter | $\\gamma < 0$ | $\\gamma = 0$ | $\\gamma >0$ |\n| Underlying Distribution | `Beta` `Uniform` `Triangular` | `Chi-square` `Exponential` `Gamma` `Log-normal` `Normal` `Weibull` | `Burr` `F` `Log-gamma` `Pareto` `t` |\n| Range of values permitted | $x < \\alpha - \\dfrac{\\beta}{\\gamma}$ | $-\\infty < x < \\infty$ | $x > \\alpha - \\dfrac{\\beta}{\\gamma}$ |\n\n**Criteria** to predict which family a particular distribution belongs to\n\n* **Finite upper limits** $\\Rightarrow$ Weibull\n* **Light tail** + **finite moments** $\\Rightarrow$ Gumbel\n* **Heavy tail** + **infinite moments** $\\Rightarrow$ Fréchet\n\n### Fitting a GEV Distribution\n\nNeed to subdivide data into groups and calculate the maximum for each group\n\n#### Return levels and periods\n\nGEV distribution can be used to analyse a set of observed losses in 2 different ways\n\n1. **Return-level approach**\n\n    Select the maximum observation in each block\n\n2. **Return-period approach**\n\n    Count the observations in each block that exceed some set level\n\n***Number of blocks***\n\nThe **larger** the number of blocks, the fewer observations in each block $\\Rightarrow$ Gives less information about extreme values (e.g. for approach 1. we get 1-in-100 rather than 1-in-1000)\n\n* Gives more \"extreme\" values to fit $\\Rightarrow$ reduces the variance of the parameter\n\nThe **fewer** blocks, more observation in each $\\Rightarrow$ more information about the extreme  values\n\n* Variance of parameter estimate is greater\n\n#### Parameterization\n\nOne we selected the data, we can estimate the parameters for the GEV distribution using MLE or method of moments\n\ne.g. using MLE to estimate the parameters of the GEV distribution if we have:\n\n* Data divided into $m$ blocks of size $n$\n* Maximum of the $j$^th^ block to be $M_{nj}$ (i.e. the maximum data are $M_{n1},...,M_{nm}$)\n\nUsing the density function of the GEV distribution $h(x)$, we can get the log-likelihood:\n\n$\\ln\\left( L(\\gamma, \\alpha, \\beta) \\right) = \\sum \\limits_{i=1}^m \\ln\\left( h(M_{ni}) \\right)$\n\nMaximize with the following constraints:\n\n* $\\beta > 0$\n* $\\left(1 + \\gamma \\dfrac{M_{ni} - \\alpha}{\\beta} \\right) > 0$\n\n### Advantages/Disadvantages\n\nWe can use GEV distributions to investigate the limiting distributions for the minimum values of a distribution\n\nGiven $H(x)$: limiting dist^n^ for the maximum value for a particular $\\gamma$ $\\Rightarrow$ $1 - H(-x)$ is the limiting dist^n^ for the minimum value from the same original dist^n^\n\n***Limitations**\n\n1. A lot of **data (information) is lost**\n    \n    Everything apart from the maxima in each block is effectively ignored\n    \n2. Choice of **block size** can be subjective\n\n    Compromise between `granularity` (1-in-100 vs 1-in-1000) and `parameter uncertainty`\n    \n## Generalized Pareto Distribution\n\nConsider all claim values exceed some threshold as extreme values\n\nFor large samples, the distribution of these extreme values converges to the generalized Pareto distribution (GPD)\n\nNeed to select a suitably high threshold to fit the GPD\n\n### Threshold Exceedances\n\nIf we let $X$ be a r.v. with distribution $F$\n\nThen the XS distribution over the threshold $u$ has the distribution function:\n\n$F_u(x) = P(X - u \\leq x \\mid X > u) \\ \\dfrac{F(x+u) - F(u)}{1 - F(u)}$\n\n* For $x \\leq x < x_F - u$ where $x_F \\leq \\infty$ is the right endpoint of $X$\n\nIf the losses are *iid*, as the threshold $\\uparrow$, the distribution of the conditional losses $\\lim \\limits_{u \\rightarrow \\infty} F_u(x)$ will converge to the GPD $G(x)$\n\n$G(x) = \n  \\begin{cases}\n    1 - \\left(1+\\dfrac{x}{\\gamma \\beta} \\right)^{-\\gamma} & \\gamma \\neq 0 \\\\\n    1 - \\exp\\left\\{ - \\dfrac{x}{\\beta}\\right\\} & \\gamma = 0\\\\\n  \\end{cases}$\n\n* $\\beta > 0$: Scale parameter\n* $\\gamma$: Shape parameter\n* CDF of the standardized GPD has $\\beta = 1$\n\n***Characteristics***\n\nBounds\n\n* Lower bound: $x \\geq 0$ when $\\gamma > 0$\n* Upper bound: $0 \\leq x \\leq - \\gamma \\beta$ when $\\gamma < 0$\n\nIf $\\gamma > 0$ then the GPD becomes the Pareto distribution\n\nMean of the GPD: $\\mathrm{X} = \\dfrac{\\gamma \\beta}{\\gamma -1}$ provided $\\gamma > 1$\n\nIf $\\gamma >0$ then $\\mathrm{E}(X^k) = \\infty$ for $k \\geq \\gamma$\n\n* e.g. if $\\gamma \\leq 2$ then we have $\\mathrm{E}(X^2) = \\infty$ (i.e. we have infinite variance)\n\n![](figures/figure-18.20.png)\n\n### Asymptotic Property\n\nWhen the maxima of a distribution converge to a GEV distribution, the XS distribution converges to a GPD distribution with an equivalent shape parameter $\\gamma$\n\n### Mean XS Function\n\n**Mean XS function** $e(u)$:\n\n$e(u) = \\mathrm{E}(X-u \\mid X > u)$\n\n* Helps with fitting a GPD\n\n**Empirical mean XS function** $e_N(u)$:\n\n$e_N(u) = \\dfrac{\\sum \\limits_{i=1}^N (X_i - u)I(X_i>u)}{\\sum \\limits_{i=1}^N I(X_i>u)}$\n\n* Calculated for each of the $N$ observed data points by setting $u=X_i$ for $i=1,...,N$\n\n**Mean XS plot**\n\nEach of the observed losses has been treated as a potential threshold (on the x-axis) and the mean XS loss based on that threshold has been calculated and plotted (y-axis)\n\n![](figures/figure-18.21.png)\n\n**Example**\n\nMean XS function for $X\\sim Exp(\\lambda)$\n\n$\\begin{align}\n  F_u(x) &= P(X \\leq x + u \\mid x >u) & \\\\\n  &= P(X \\leq x) & \\text{Since memoriness} \\\\\n  &= F(x)\\\\\n\\end{align}$\n\nSo the XS distribution is also $Exp(\\lambda)$ and the mean XS function is $e(u) = \\dfrac{1}{\\lambda}$, which is independent of $u$\n\n### Fitting a GPD\n\nNeed to decide on the threshold $u$, above which we will approximate the underlying distribution with the GPD\n\nShould consider the **context** when picking $u$\n\n* e.g. XS over which a reinsurer might be liable to cover\n\nTypically $u$ is around the 90-95^th^ percentile of the full distribution\n\n**Consideration** for choosing threshold $u$\n\nTrade off between `quality of the approximation` to the GPD (good for high $u$) vs `level of bias` in the fit we achieve (good for low $u$)\n\n**High value** for $u$\n\n* The asymptotic properties apply more accurately (as we are closer to $\\infty$)\n* But have few data values to work with (estimates may be unreliable)\n\nRecall (asymptotic property):  \nWhen maxima of a dist^n^ ($M_{ni}$) converge to a GEV, the XS dist^n^ ($F_u(x)$) converge to GPD w/ equivalent $\\gamma$\n\nUnder the above circumstances $e(u)$ will become a linear function of $u$\n\n* If we plot $e(u)$ against $u$ we should see linearity appear for higher values of $u$\n\n    Slope of this line is related to $\\gamma$ $\\therefore$ facilitating the fitting of a GPD distribution to the empirical XS distribution\n    \nSo to select a suitable threshold, we are looking for the mean XS to be linear to $u$\n\n* Graphical test for tail behavior can then be based on the empirical mean XS function\n\nIn the $Exp(lambda)$ example above, the mean XS function was constant (i.e. slope was 0), but for other distributions the mean XS function will slope upwards it $\\gamma$ is (+) and downwards if $\\gamma$ is (-)\n\n***Mean XS simulations***\n\nBelow is a selection of mean XS loss plots from simulation\n\n* Each is based on the same underlying $Exp(\\lambda)$ distribution\n\nThere is a large random element to the plots' appearance and many of them are far from horizontal\n\nTherefore selecting a suitable threshold (and value of $\\gamma$) is very difficult\n\n![](figures/figure-18.22.png)\n\n***Example***\n\nBased on the sample mean XS plot (from the mean XS function section)\n\nBelow shows the different possibilities for choosing the threshold\n\n![](figures/figure-18.23.png)\n\n* Longest (solid) line is the least squares linear regression on the whole data set\n* Shorter (dotted) line is a regression on just the tail (above 100,000)\n* Shortest (dashed) line is a regression on the tail (above 100,000) excluding the final five points\n\nThis again, shows the subjectivity in the fitting process\n\n#### Parameterization\n\nAbove the chosen threshold, we can fit a GPD by using standard techniques (e.g. MLE, Method of moments) to calculate $\\gamma$ and $\\beta$\n\n***MLE Example***\n\nData before cut off $X = \\{X_1,...,X_n\\}$ is assumed to be *iid*\n\n$Y_j = X_j - u$ is the amount of the XS loss when the threshold is exceeded\n\nAssume $Y_j$ follow a GPD, not the $X_j$\n\nAssume a random number of observations $N_u$ exceed the threshold\n\nIf we attempt to fit a GPD with parameters $\\gamma$ and $\\beta$ and probability density function $g(x)$ to the data $(Y_1, Y_2, ...,Y_n)$ then we get the following lo-likelihood function:\n\n$\\ln \\left( L(\\gamma,\\beta; Y) \\right) = \\sum \\limits_{j=1}^N_u \\ln \\left( g(Y_j) \\right)$\n\nDomain of valid values for $x$ will depend on the values of the parameters $\\gamma$ and $\\beta$",
    "created" : 1472005534664.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "23322803",
    "id" : "5F86AF61",
    "lastKnownWriteTime" : 1472086205,
    "last_content_update" : 1472086205731,
    "path" : "~/Git Repos/Exam ST9 2016 Notes/4. Risk Modeling/20-Extreme-Value-Theory.Rmd",
    "project_path" : "4. Risk Modeling/20-Extreme-Value-Theory.Rmd",
    "properties" : {
        "docOutlineVisible" : "1",
        "ignored_words" : "sev,dfrac,sqrt,maxima,ln,rightarrow,infty,havs,reinsured,Weibull,Fréchet,Rightarrow,th,nm,ni,leq,geq,mathrm,memoriness,reinsurer\n"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}