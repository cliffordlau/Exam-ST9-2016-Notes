{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Module 20: Extreme Value Theory\"\nauthor: \"C. Lau\"\ndate: \"`r format(Sys.time(), '%B %d, %Y')`\"\noutput: \n  html_document:\n    toc: true\n    toc_float:\n      collapsed: false\n      smooth_scroll: false\n    toc_depth: 4\n---\n\n## Module Objective\n\nExplain the importance of the tails of distributions, tail correlations and low freq/ high severity events\n\nDemonstrate how extreme value theory can be used to help model risks that have a low probability\n\n***\n\nLook more closely at the **tails of distributions**\n\nFocus is on considering the modeling of risks with low freq and high sev\n\nNeed to be able to recommend a specific approach and choice of **model for the tails** based on a mixture of **quantitative analysis** and **graphical diagnostics**\n\nShould be able to describe how the main theoretical results can be used in practice\n\n## Tail Distributions/ Correlations\n\nImportant to model the tail of a distribution accurately due to the potentially devastating impact on companies\n\n### Low Freq/ High Sev Events\n\n***Extreme events***:\n\n* Outcomets that have a **low probability* of occurence but involve **very large sums of money**\n\n* Low frequency $\\Rightarrow$ Little data to model their effects accurately\n\n* Occur in the **right hand tail** of the loss distribution\n\n* For insurance:\n\n    * Result of a single cause that has a high financial cost\n    \n        (e.g. personal injury claim or complete destruction of a building)\n        \n    * Accumulation of events with a related cause\n    \n        (e.g. flood damage to a large number of houses in one town)\n        \n* Extreme events can occur in contexts other than insurance claims\n\n    e.g. financial losses caused by stock market crash or default of a company on the \"credit crunch\"\n\n***Example***:\n\n* 2008 credit crisis generated more extreme movements in equity values and credit spreads than had been seen over the 20 years previously\n\n* Oct 19 1987 Black Monday S&P fell by 20.5% (Which is a 1-in-2100 event based on the estimated return period)\n\n* 9/11 and other natural disasters like 2013 Philippines typhoon\n\n***Extreme events should be consider separately***\n\n* Typical risk events fall within the main body of the fitted loss distribution\n\n* Extreme events fall in the right hand tail of the distribution\n\n    Arise through a different cause than the smaller losses\n    \n    $\\therefore$ They are considered to come from a different statistical distribution\n    \n* Important to assess correctly as it involve the highest monetary amounts\n\n* Models of extreme events are important for assessing the impact on a company of unexpected conditions and can help with disaster reovery, business continuity planning etc\n\n* Typically there is a lack of past data on extreme events and so a different approach to modeling needs to be taken\n\n    (e.g. dreaming up \"doomsday\" type scenarios)\n    \n***Challenge of modeling the tail***\n\n1. We can model the tail by modeling the full distribution but need make sure the **form of the distribution is correct in the tails**\n\n    * Use data from both stressed and non-stressed periods to fit the distribution\n    \n    * Financial data is typically more **leptokurtic** (narrow peak and fat tail)\n    \n        $\\therefore$ Extreme values for equity occur more frequently than predicted with a normal distribution\n    \n        * A better distribution would be *t* distribution\n\n    **Reasons for fat tails** in financial data\n\n    * **Heteroscedastic** returns (i.e. volatility varies over time)\n    \n    * Innovation in a heteroscedastic model are best modeled using a fat tailed distribution\n\n2. **Fitting the tail**\n\n    * Difficult since paramter estimates are **heavily influenced** by the main bulk of the data in the **middle of the distribution**\n    \n    * This is where extreme value theory comes can help\n    \n## Extreme Value Theory\n\n### Definition of Extreme\n\n1. Consider an extreme value as the **maximum value in a set** of $n$ losses\n\n    **Block maximum**\n    \n    e.g. $X_M = max(X_1,X_2,...,X_n)$\n\n2. Consider all losses that exceed a certain **threshold** as being extreme\n\n### Limiting Behaviour\n\nFor **losses that have typical sizes** (values from the central part of the distribution) we can use **CLT**:\n\n* ***CLT***:\n\n    Standardized value of the average loss $\\dfrac{\\bar{X} - \\mu}{\\sigma/\\sqrt{n}}$ can be approximated using a normal distribution\n    \n      * $\\bar{X}$ is the mean of the $n$ samples from a distribution with mean $\\mu$ and variance $\\sigma$\n    \n* Need similar method to estimate the behavior of the extreme values in the tail of the distribution\n\n***Extreme value theory***:\n\n* Has the 2 main results below (maxima and threshold exceedances)\n\n* Key idea is that there are certain families **of distributions** (`Generalized Extreme Value` and `Generalized Pareto`) that **describe the behavior of the tails** of many distributions\n\n#### Maxima\n\n$X_M = max(X_1, X_2,...,X_n)$\n\n* Block maxima\n\n* The distribution of $X_M$ is approximately described by the **Generalized Extreme Value (GEV) family** of distributions\n\n    * If $n$ is sufficiently large\n\n* If we look at a number of such blocks then these maxima can be standardized in a similar way\n\n    i.e. We calculate expressions of the form $\\dfrac{X_M - \\alpha_n}{\\beta_n}$\n    \n* Can approximate by an extreme value distribution\n\n#### Threshold Exceedances\n\n$\\Pr(X>x+u \\mid X>u)$\n\n* The tail of the distribution above a threshold\n\n* Can be approximated, for large values of $u$ by the **Generalized Pareto Distribution** (GPD)\n\n* Consider the expected size of losses that exceed a certain thresholds\n\n## Generalized Extreme Value Distribution\n\nGeneralized Extreme Value family of distributions are important in the study of limiting behavior of sample extremes\n\n### Extreme Values Theorem (EVT)\n\n***Distribution*** of $X_M$\n\n* $X_M = max(X_1, X_2,...,X_n)$ where each $X_i$ is an observed loss\n\n* If losses are *iid* with CDF $F$:\n\n    $\\begin{align}\n      P(X_M \\leq x) &= P(X_1 \\leq x, X_2 \\leq x, ..., X_n \\leq x) \\\\\n      &= P(X_1\\leq x)P(X_2\\leq x)...P(X_n \\leq x) \\\\\n      &= \\left[ P(X_1\\leq x) \\right]^n \\\\\n      &= \\left[ F(x) \\right]^n \\\\\n      &= F^n (x)\\\\\n    \\end{align}$\n\n* Standardized for a sequence of **real constants**\n\n    $\\beta_1,...,\\beta_n > 0$\n    \n    $\\alpha_1,...,\\alpha_n$\n    \n* Consider the limit as $n$ increases:\n\n    Limiting distribution $H(x)$\n\n    $H(x) = \\lim \\limits_{n \\rightarrow \\infty} P \\left(\\dfrac{X_M - \\alpha_n}{\\beta_n} \\leq x \\right) = \\lim \\limits_{n \\rightarrow \\infty} F^n(\\beta_n x + \\alpha_n)$\n\nResult **applies for all commonly used statistical distributions** from which the $X_i$ may originate\n\n***Example***\n\n* Determine $H(x)$ where $X_i$ are exponentially distribution (i.e. $F(x) = 1 - e^{-\\lambda x}$)\n\n    By setting the following:\n    \n    * $\\beta = \\dfrac{1}{\\lambda}$\n    \n        (i.e. $\\beta_n = \\beta$ for all $n$)\n    \n    * $\\alpha_n = \\dfrac{1}{\\lambda} \\ln(n)$\n\n* Substituting the above into $\\beta x + \\alpha_n$:\n\n    $\\begin{align}\n      F(\\beta x + \\alpha_n) &= F\\left( \\dfrac{x + \\ln(n)}{\\lambda} \\right) \\\\\n      &= 1 - \\exp\\left\\{-\\lambda\\left(\\dfrac{x + \\ln(n)}{\\lambda}\\right)\\right\\} \\\\\n      &= 1 - \\dfrac{1}{n}e^{-x} \\\\\n    \\end{align}$\n\n* Taking the limit $\\rightarrow \\infty$\n\n    $\\begin{align}\n      \\lim \\limits_{n \\rightarrow \\infty} F^n(\\beta_n x + \\alpha_n) &= \\lim \\limits_{n \\rightarrow \\infty} \\left( 1 - \\dfrac{1}{n}e^{-x} \\right)^n & \\\\\n      &= e^{-e^{-x}} & \\text{since } e^x = \\lim \\limits_{n \\rightarrow \\infty} \\left( 1 + \\dfrac{x}{n}\\right)^n \\\\\n    \\end{align}$\n  \n### GEV Distribution\n\nGEV family of distributions havs **3 parameters**\n\n1. $\\alpha$: **location** parameter\n\n2. $\\beta > 0$: **scale** parameter\n\n    $\\alpha$ and $\\beta$ just rescale (**shift** and **stretch**) the distribution (similar to mean and s.d.)\n    \n3. $\\gamma$: **shape** parameter\n\n***CDF of the GEV family***:\n\n$P(X_M \\leq x) \\approx H(x)\n\\begin{cases}\n  \\exp\\left\\{ -\\left( 1 + \\dfrac{\\gamma(x-\\alpha)}{\\beta} \\right)^{\\frac{-1}{\\gamma}} \\right\\} & \\gamma \\neq 0 \\\\\n  \\exp\\left\\{ - \\exp\\left\\{ - \\dfrac{(x-\\alpha)}{\\beta} \\right\\} \\right\\} & \\gamma = 0\\\\\n\\end{cases}$\n\n***Special case***\n\n* CDF of the ***standard*** GEV distribution has $\\alpha=0$ and $\\beta =1$\n\n#### Three Forms of GEV\n\nThe forms of the GEV family distribution is determined by the sign of $\\gamma$ [(+), (-), 0]\n\n***Gumbel GEV***\n\n$\\gamma=0$\n\nTail **falls exponentially**\n\n![](figures/figure-18.18.png)\n\n***Weibull GEV***\n\n$\\gamma<0$\n\n**Finite upper bound** indicating an absolute maximum\n\n*Application*:\n\n* Distribution of **natural phenomenon**\n\n    e.g. `temperature`, `wind-speed`, `age of human population` etc\n\n* When loss was **certain not to exceed** a certain value\n\n    e.g. reinsured\n\n![](figures/figure-18.17.png)\n\n***FrÃ©chet-type GEV***\n\n$\\gamma > 0$\n\n**Tails** of the distribution become **heavier**\n\n* Follow a **power** law\n\n* $\\gamma > \\dfrac{1}{2}$ \n\n    $\\hookrightarrow$ Infinite variance \n\n*Application*:\n\n* Most suitable for modeling **extreme financial loss events**\n\nDistribution has a ***lower bound***:\n\n* Since $x$ takes values such that\n\n    $1 + \\dfrac{\\gamma{x-\\alpha}}{\\beta}$\n    \n    $\\hookrightarrow$ $x - \\alpha > \\dfrac{-\\beta}{\\gamma}$\n    \n    $\\hookrightarrow$ $x > \\alpha - \\dfrac{\\beta}{\\gamma}$\n\n![](figures/figure-18.19.png)\n\n### Underlying Distribution\n\nIf we know the form of the **underlying loss distribution** we can work out the limiting distribution of the maximum value ($H(x)$)\n\n$\\hookrightarrow$ We can classify the resulting distribution into one of the 3 types based on the sign of $\\gamma$\n\n***\n\n***GEV Distributions*** (for the maximum value) corresponding to common loss distributions\n\n| Type | Weibull | Gumbel | FrÃ©chet |\n| ------------ | ----------- | -------------- | ---------------- |\n| Shape Parameter | $\\gamma < 0$ | $\\gamma = 0$ | $\\gamma >0$ |\n| Underlying Distribution | `Beta` `Uniform` `Triangular` | `Chi-square` `Exponential` `Gamma` `Log-normal` `Normal` `Weibull` | `Burr` `F` `Log-gamma` `Pareto` `t` |\n| Range of values permitted | $x < \\alpha - \\dfrac{\\beta}{\\gamma}$ | $-\\infty < x < \\infty$ | $x > \\alpha - \\dfrac{\\beta}{\\gamma}$ |\n\n***Criteria to predict*** which family a particular distribution belongs to\n\n* **Finite upper limits** $\\Rightarrow$ Weibull\n\n* **Light tail** + **finite moments** $\\Rightarrow$ Gumbel\n\n* **Heavy tail** + **infinite moments** $\\Rightarrow$ FrÃ©chet\n\n### Fitting a GEV Distribution\n\nNeed to **subdivide data** into groups and calculate the **maximum for each group**\n\n#### Return levels and periods\n\nGEV distribution can be used to analyse a set of observed losses in 2 different ways\n\n1. **Return-level approach**\n\n    Select the maximum observation in each block\n\n2. **Return-period approach**\n\n    Count the observations in each block that exceed some set level\n\n***Number of blocks***\n\n* The **larger** the number of blocks, the fewer observations in each block \n\n    $\\hookrightarrow$ Gives **less information about extreme values** (e.g. for approach 1. we get 1-in-100 rather than 1-in-1000)\n\n    * Gives more \"extreme\" values to fit\n    \n        $\\hookrightarrow$ **reduces the variance** of the parameter\n\n* The **fewer** blocks (more observation in each block)\n\n    $\\hookrightarrow$ more information about the extreme values\n\n    * Variance of parameter estimate is greater\n\n#### Parameterization\n\nOne we selected the data, we can estimate the parameters for the GEV distribution using `MLE` or `method of moments`\n\nUsing ***MLE*** to **estimate the parameters** of the GEV distribution\n\n1. *Given*:\n    \n    i. Data divided into $m$ blocks of size $n$\n\n    ii. Maximum of the $j$^th^ block to be $M_{nj}$ (i.e. the maximum data are $M_{n1},...,M_{nm}$)\n\n2. Using the density function of the GEV distribution $h(x)$ to calculate the log-likelihood:\n\n    $\\ln\\left( L(\\gamma, \\alpha, \\beta; M_n) \\right) = \\sum \\limits_{i=1}^m \\ln\\left( h(M_{ni}) \\right)$\n\n    * Maximize with the following **constraints**:\n\n        $\\beta > 0$\n        \n        $\\left(1 + \\gamma \\dfrac{M_{ni} - \\alpha}{\\beta} \\right) > 0$\n\n### Advantages/Disadvantages\n\nWe can use GEV distributions to investigate the limiting distributions for the minimum values of a distribution\n\n* $H(x)$: limiting dist^n^ for the **maximum value** for a particular $\\gamma$ \n\n    $\\hookrightarrow$ $1 - H(-x)$ is the limiting dist^n^ for the **minimum value** from the same original dist^n^\n\n***Limitations*** of the GEV approach\n\n1. A lot of **data (information) is lost**\n    \n    Everything apart from the maxima in each block is effectively ignored\n    \n2. Choice of **block size** can be subjective\n\n    Compromise between `granularity` (1-in-100 vs 1-in-1000) and `parameter uncertainty`\n    \n## Generalized Pareto Distribution\n\nConsider all claim values **exceed some threshold** as extreme values\n\n* For large samples, the distribution of these extreme values **converges** to the **generalized Pareto distribution** (GPD)\n\n* Need to **select a suitably high threshold** to fit the GPD\n\n### Threshold Exceedances\n\n***Excess distribution over the threshold u*** $F_u(x)$\n\n* *Let* $X$ be a r.v. with distribution $F$\n\n    $F_u(x) = P(X - u \\leq x \\mid X > u) \\ = \\dfrac{F(x+u) - F(u)}{1 - F(u)}$\n\n    * For $x \\leq x < x_F - u$\n    \n        *Where* $x_F \\leq \\infty$ is the right endpoint of $X$\n\n***Generalized Pareto distribution***\n\n* If the losses are *iid*, as the threshold $\\uparrow$\n\n    $\\hookrightarrow$ The distribution of the conditional losses $\\lim \\limits_{u \\rightarrow \\infty} F_u(x)$ will **converge to the GPD** $G(x)$\n\n    $G(x) = \n      \\begin{cases}\n        1 - \\left(1+\\dfrac{x}{\\gamma \\beta} \\right)^{-\\gamma} & \\gamma \\neq 0 \\\\\n        1 - \\exp\\left\\{ - \\dfrac{x}{\\beta}\\right\\} & \\gamma = 0\\\\\n      \\end{cases}$\n\n    * $\\beta > 0$: **Scale** parameter\n\n    * $\\gamma$: **Shape** parameter\n\n    * CDF of the **standardized GPD** has $\\beta = 1$\n\n***Characteristics***\n\n* **Lower bound** when $\\gamma > 0$:\n\n    $x \\geq 0$\n    \n* **Upper bound** when $\\gamma < 0$:\n\n    $0 \\leq x \\leq - \\gamma \\beta$ \n\n* If $\\gamma > 0$\n\n    $\\hookrightarrow$ GPD becomes the **Pareto distribution**\n\n* **Mean of the GPD**:\n\n    $\\mathrm{X} = \\dfrac{\\gamma \\beta}{\\gamma -1}$\n    \n    * Provided $\\gamma > 1$\n\n* If $\\gamma >0$\n\n    $\\rightarrow$ $\\mathrm{E}(X^k) = \\infty$ for $k \\geq \\gamma$\n\n    e.g. if $\\gamma \\leq 2$ then we have $\\mathrm{E}(X^2) = \\infty$ (i.e. we have infinite variance)\n\n![](figures/figure-18.20.png)\n\n### Asymptotic Property {#asy-prop}\n\nWhen the **maxima of a distribution** *converge* to a `GEV distribution`, the **XS distribution** *converges* to a `GPD distribution` (with an equivalent shape parameter $\\gamma$)\n\n### Mean XS Function\n\n***Mean XS function*** $e(u)$:\n\n$e(u) = \\mathrm{E}(X-u \\mid X > u)$\n\n* Helps with **fitting a GPD**\n\n***Empirical mean XS function*** $e_N(u)$:\n\n$e_N(u) = \\dfrac{\\sum \\limits_{i=1}^N (X_i - u)I(X_i>u)}{\\sum \\limits_{i=1}^N I(X_i>u)}$\n\n* Calculated for each of the $N$ observed data points by setting $u=X_i$ for $i=1,...,N$\n\n***Mean XS plot***\n\nEach of the observed losses has been treated as a **potential threshold** (on the *x-axis*) and the **mean XS loss** based on that threshold has been calculated and plotted (*y-axis*)\n\n![](figures/figure-18.21.png)\n\n***Example***\n\nMean XS function for $X\\sim Exp(\\lambda)$\n\n$\\begin{align}\n  F_u(x) &= P(X \\leq x + u \\mid x >u) & \\\\\n  &= P(X \\leq x) & \\text{Since memoriness} \\\\\n  &= F(x)\\\\\n\\end{align}$\n\nSo the XS distribution is also $Exp(\\lambda)$ and the mean XS function is $e(u) = \\dfrac{1}{\\lambda}$, which is independent of $u$\n\n### Fitting a GPD\n\nNeed to **decide on the threshold** $u$, above which we will approximate the underlying distribution with the GPD\n\n* Should consider the **context** when picking $u$\n\n    e.g. XS over which a reinsurer might be liable to cover\n\n    Typically $u$ is around the 90-95^th^ percentile of the full distribution\n\n***Consideration*** for choosing threshold $u$\n\n* *Trade off* between:\n\n    **Quality of the approximation** to the GPD (good for high $u$)\n    \n    *vs*\n    \n    **level of bias** in the fit we achieve (good for low $u$)\n\n* For **high value** for $u$\n\n    * The **asymptotic properties apply more accurately** (as we are closer to $\\infty$)\n\n    * But have **few data values to work** with (estimates may be unreliable)\n\nRecall ([asymptotic property](#asy-prop)):\n\n* When maxima of a dist^n^ ($M_{ni}$) converge to a GEV, then the XS dist^n^ ($F_u(x)$) converge to GPD w/ equivalent $\\gamma$\n\n* Under the above circumstances $e(u)$ will become a **linear function** of $u$\n\n    $\\therefore$ If we **plot** $e(u)$ *against* $u$ we should see linearity appear for higher values of $u$\n\n    * Slope of this line is related to $\\gamma$\n    \n        $\\therefore$ facilitating the **fitting of a GPD** distribution to the **empirical XS distribution**\n\nSo to ***select a suitable threshold***\n\n* We are looking for the **mean XS** to be **linear** to $u$\n\n* **Graphical test** for tail behavior can then be based on the empirical mean XS function\n\n* Look at the slope of the line\n\n    * Slop upwards $\\Rightarrow$ $\\gamma$ is (+)\n    \n    * Slop downwards $\\Rightarrow$ $\\gamma$ is (-)\n\nRecall:\n\n* In the $Exp(\\lambda)$ example above, the mean XS function was constant (i.e. slope was 0)\n\n* But for other distributions the mean XS function will slope upwards if $\\gamma$ is (+) and downwards if $\\gamma$ is (-)\n\n***Mean XS simulations***\n\nBelow is a selection of mean XS loss plots from simulation\n\n* Each is based on the same underlying $Exp(\\lambda)$ distribution\n\nThere is a large random element to the plots' appearance and many of them are far from horizontal (theoretically the slope should be 0)\n\nTherefore selecting a suitable threshold (and value of $\\gamma$) is very difficult\n\n![](figures/figure-18.22.png)\n\n***Example***\n\nBased on the sample mean XS plot (from the mean XS function section)\n\nBelow shows the **different possibilities for choosing** the threshold\n\n![](figures/figure-18.23.png)\n\n1. Longest (solid) line is the least squares linear regression on the whole data set\n\n2. Shorter (dotted) line is a regression on just the tail (above 100,000)\n\n3. Shortest (dashed) line is a regression on the tail (above 100,000) excluding the final five points\n\nThis again, shows the **subjectivity** in the fitting process\n\n#### Parameterization\n\nAbove the chosen threshold, we can fit a GPD by using standard techniques (e.g. `MLE`, `Method of moments`) to calculate $\\gamma$ and $\\beta$\n\n***MLE Example***\n\n* Data before cut off $X = \\{X_1,...,X_n\\}$ is assumed to be *iid*\n\n* $Y_j = X_j - u$ is the amount of the XS loss when the threshold is exceeded\n\n    * *Assume* $Y_j$ follow a GPD, not the $X_j$\n\n* Assume a random number of observations $N_u$ exceed the threshold\n\n* If we attempt to fit a GPD with parameters $\\gamma$ and $\\beta$ and PDF $g(x)$ to the data $(Y_1, Y_2, ...,Y_n)$ then we get the following log-likelihood function:\n\n    $\\ln \\left( L(\\gamma,\\beta; Y) \\right) = \\sum \\limits_{j=1}^{N_u} \\ln \\left( g(Y_j) \\right)$\n\n**Domain** of valid values for $x$ will **depend*8 on the values of the parameters $\\gamma$ and $\\beta$",
    "created" : 1474665660345.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3196635761",
    "id" : "B6C6C496",
    "lastKnownWriteTime" : 1474769065,
    "last_content_update" : 1474769065975,
    "path" : "~/Git Repos/Exam ST9 2016 Notes/4. Risk Modeling/20-Extreme-Value-Theory.Rmd",
    "project_path" : "4. Risk Modeling/20-Extreme-Value-Theory.Rmd",
    "properties" : {
        "docOutlineVisible" : "1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}